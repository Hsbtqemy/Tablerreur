# Tablerreur — NAKALA Baseline overlay
# Activates NAKALA-specific validation on the 5 required NAKALA fields.
# Merge this on top of a generic template via TemplateManager.
#
# Two complementary validation layers:
#   1. nakala.* rules   → dynamic validation via NakalaClient (online, preferred)
#   2. allowed_values   → static offline fallback (locked, from API snapshot 2026-02)
version: 1
id: nakala_baseline
name: "NAKALA Baseline"
scope: builtin
type: overlay

# Required NAKALA columns (must be present in the dataset)
required_columns:
  - "nakala:type"
  - "nakala:title"
  - "nakala:creator"
  - "nakala:created"
  - "nakala:license"

rules:
  # NAKALA-specific rules (implemented in core/rules/nakala_rules.py)
  nakala.deposit_type:
    enabled: true
    severity: ERROR

  nakala.license:
    enabled: true
    severity: ERROR

  nakala.created_format:
    enabled: true
    severity: ERROR

  # Keep generic hygiene active
  generic.hygiene.leading_trailing_space:
    enabled: true
    severity: WARNING

  generic.pseudo_missing:
    enabled: true
    severity: WARNING

# Per-column configurations for NAKALA required fields
columns:
  "nakala:type":
    kind: controlled
    required: true
    # Offline fallback: full list of COAR resource type URIs (29 values, snapshot 2026-02)
    # NakalaClient (when available) also validates dynamically via nakala.deposit_type rule.
    allowed_values:
      - "http://purl.org/coar/resource_type/c_c513"
      - "http://purl.org/coar/resource_type/c_12ce"
      - "http://purl.org/coar/resource_type/c_18cc"
      - "http://purl.org/coar/resource_type/c_6501"
      - "http://purl.org/coar/resource_type/c_6670"
      - "http://purl.org/coar/resource_type/c_c94f"
      - "http://purl.org/coar/resource_type/c_e059"
      - "http://purl.org/coar/resource_type/c_2f33"
      - "http://purl.org/coar/resource_type/c_12cd"
      - "http://purl.org/coar/resource_type/c_ddb1"
      - "http://purl.org/coar/resource_type/c_5ce6"
      - "http://purl.org/coar/resource_type/c_1843"
      - "http://purl.org/coar/resource_type/YC9F-HGCF"
      - "http://purl.org/coar/resource_type/F8RT-TJK0"
      - "http://purl.org/coar/resource_type/c_86bc"
      - "http://purl.org/coar/resource_type/c_ba08"
      - "http://purl.org/coar/resource_type/c_0040"
      - "http://purl.org/coar/resource_type/c_0857"
      - "http://purl.org/coar/resource_type/c_93fc"
      - "http://purl.org/coar/resource_type/c_2fe3"
      - "http://purl.org/coar/resource_type/c_816b"
      - "http://purl.org/coar/resource_type/c_efa0"
      - "http://purl.org/coar/resource_type/c_18cw"
      - "http://purl.org/coar/resource_type/NHD0-W6SY"
      - "http://purl.org/coar/resource_type/c_18cf"
      - "http://purl.org/coar/resource_type/c_46ec"
      - "http://purl.org/coar/resource_type/c_7ad9"
      - "http://purl.org/coar/resource_type/c_beb9"
      - "http://purl.org/coar/resource_type/c_e9a0"
    allowed_values_locked: true
    rule_overrides:
      nakala.deposit_type:
        enabled: true

  "nakala:title":
    kind: free_text_short
    required: true
    rule_overrides:
      generic.pseudo_missing:
        enabled: true
        severity: ERROR

  "nakala:creator":
    kind: structured
    required: true
    # Format attendu : "Nom, Prénom" (optionnellement suivi d'un ORCID)
    regex: "^[^,]+,\\s*.+"
    # Warn when | used in-cell (suggest split to repeated columns)
    pipe_in_cell_warning: true
    rule_overrides:
      generic.unexpected_multiline:
        enabled: false

  "nakala:created":
    kind: structured
    required: true
    rule_overrides:
      nakala.created_format:
        enabled: true

  "nakala:license":
    kind: controlled
    required: true
    # NakalaClient validates dynamically (620 SPDX codes) when available.
    # No offline fallback here: the list is too large and changes frequently.
    rule_overrides:
      nakala.license:
        enabled: true

policies:
  warn_pipe_in_repeatable_fields: true
  allow_pipe_in_description: true
  recommend_split_to_repeated_columns: true

export:
  multivalues_mode: expanded
  list_separator: "|"

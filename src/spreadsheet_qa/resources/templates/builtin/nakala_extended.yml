# Tablerreur — NAKALA Extended overlay
# Full NAKALA coverage including recommended fields, language validation,
# multilingual column groups, creator format checks, and keyword columns.
# Merge this on top of a generic template via TemplateManager.
version: 1
id: nakala_extended
name: "NAKALA Extended"
scope: builtin
type: overlay

# Required NAKALA columns
required_columns:
  - "nakala:type"
  - "nakala:title"
  - "nakala:creator"
  - "nakala:created"
  - "nakala:license"

# Recommended columns (no error if absent, but rules activate when present)
recommended_columns:
  - "dcterms:description"
  - "dcterms:language"
  - "dcterms:subject"
  - "dcterms:identifier"
  - "dcterms:relation"

rules:
  # NAKALA-specific validation rules
  nakala.deposit_type:
    enabled: true
    severity: ERROR

  nakala.license:
    enabled: true
    severity: ERROR

  nakala.created_format:
    enabled: true
    severity: ERROR

  nakala.language:
    enabled: true
    severity: WARNING

  # Generic hygiene (baseline)
  generic.hygiene.leading_trailing_space:
    enabled: true
    severity: WARNING

  generic.pseudo_missing:
    enabled: true
    severity: WARNING

  generic.unexpected_multiline:
    enabled: true
    severity: WARNING

column_groups:
  # Multilingual title columns: title_fr, title_en, etc.
  "nakala:title_*":
    kind: free_text_short
    required: false
    rule_overrides:
      generic.unexpected_multiline:
        enabled: false

  # Multilingual description columns
  "dcterms:description_*":
    kind: free_text_long
    multiline_ok: true
    required: false

  # Keyword / subject repeated columns: keywords_*_1, keywords_*_2, …
  "keywords_*":
    kind: list
    list_separator: "|"
    rule_overrides:
      generic.unexpected_multiline:
        enabled: false

  # Identifier / relation columns (URI format)
  "dcterms:identifier*":
    kind: structured
    regex: "^(https?://|ark:/|doi:|urn:).+"

  "dcterms:relation*":
    kind: structured
    regex: "^(https?://|ark:/|doi:|urn:).+"

columns:
  "nakala:type":
    kind: controlled
    required: true
    # Offline fallback: full list of COAR resource type URIs (29 values, snapshot 2026-02)
    allowed_values:
      - "http://purl.org/coar/resource_type/c_c513"
      - "http://purl.org/coar/resource_type/c_12ce"
      - "http://purl.org/coar/resource_type/c_18cc"
      - "http://purl.org/coar/resource_type/c_6501"
      - "http://purl.org/coar/resource_type/c_6670"
      - "http://purl.org/coar/resource_type/c_c94f"
      - "http://purl.org/coar/resource_type/c_e059"
      - "http://purl.org/coar/resource_type/c_2f33"
      - "http://purl.org/coar/resource_type/c_12cd"
      - "http://purl.org/coar/resource_type/c_ddb1"
      - "http://purl.org/coar/resource_type/c_5ce6"
      - "http://purl.org/coar/resource_type/c_1843"
      - "http://purl.org/coar/resource_type/YC9F-HGCF"
      - "http://purl.org/coar/resource_type/F8RT-TJK0"
      - "http://purl.org/coar/resource_type/c_86bc"
      - "http://purl.org/coar/resource_type/c_ba08"
      - "http://purl.org/coar/resource_type/c_0040"
      - "http://purl.org/coar/resource_type/c_0857"
      - "http://purl.org/coar/resource_type/c_93fc"
      - "http://purl.org/coar/resource_type/c_2fe3"
      - "http://purl.org/coar/resource_type/c_816b"
      - "http://purl.org/coar/resource_type/c_efa0"
      - "http://purl.org/coar/resource_type/c_18cw"
      - "http://purl.org/coar/resource_type/NHD0-W6SY"
      - "http://purl.org/coar/resource_type/c_18cf"
      - "http://purl.org/coar/resource_type/c_46ec"
      - "http://purl.org/coar/resource_type/c_7ad9"
      - "http://purl.org/coar/resource_type/c_beb9"
      - "http://purl.org/coar/resource_type/c_e9a0"
    allowed_values_locked: true
    rule_overrides:
      nakala.deposit_type:
        enabled: true

  "nakala:title":
    kind: free_text_short
    required: true
    rule_overrides:
      generic.pseudo_missing:
        enabled: true
        severity: ERROR

  "nakala:creator":
    kind: structured
    required: true
    # Format : "Nom, Prénom" (optionnellement suivi d'un ORCID ou identifiant)
    regex: "^[^,]+,\\s*.+"
    pipe_in_cell_warning: true
    rule_overrides:
      generic.unexpected_multiline:
        enabled: false

  "nakala:created":
    kind: structured
    required: true
    rule_overrides:
      nakala.created_format:
        enabled: true

  "nakala:license":
    kind: controlled
    required: true
    # NakalaClient validates dynamically (620 SPDX codes) when online.
    rule_overrides:
      nakala.license:
        enabled: true

  "dcterms:description":
    kind: free_text_long
    multiline_ok: true
    required: false
    # | is allowed as text content in descriptions
    pipe_is_text: true
    rule_overrides:
      generic.unexpected_multiline:
        enabled: false

  "dcterms:language":
    kind: controlled
    required: false
    # ISO 639-3 codes (3 letters: fra, eng, deu…)
    # NakalaClient validates dynamically (8039 codes) when online.
    rule_overrides:
      nakala.language:
        enabled: true

  "dcterms:subject":
    kind: list
    required: false
    list_separator: "|"
    pipe_in_cell_warning: true

policies:
  warn_pipe_in_repeatable_fields: true
  allow_pipe_in_description: true
  recommend_split_to_repeated_columns: true

export:
  multivalues_mode: expanded
  list_separator: "|"
